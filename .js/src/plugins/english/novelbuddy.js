var t=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(a,i){function o(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((r=r.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var n,r,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=c(0),o.throw=c(1),o.return=c(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,c[0]&&(i=0)),i;)try{if(n=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==c[0]&&2!==c[0])){i=0;continue}if(3===c[0]&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(6===c[0]&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=e.call(t,i)}catch(t){c=[6,t],r=0}finally{n=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("cheerio"),r=require("@libs/fetch"),a=function(){function a(){this.id="novelbuddy",this.name="NovelBuddy.io",this.site="https://novelbuddy.io/",this.version="1.0.1",this.icon="src/en/novelbuddy/icon.png"}return a.prototype.parseNovels=function(t){var e=[];return t(".book-item").each((function(n,r){var a,i=t(r).find(".title").text(),o="https:"+t(r).find("img").attr("data-src"),c=null===(a=t(r).find(".title a").attr("href"))||void 0===a?void 0:a.substring(1);if(c){var s={name:i,cover:o,path:c};e.push(s)}})),e},a.prototype.popularNovels=function(a){return t(this,void 0,void 0,(function(){var t,i,o;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"popular?page=").concat(a),[4,(0,r.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return i=e.sent(),o=(0,n.load)(i),[2,this.parseNovels(o)]}}))}))},a.prototype.parseNovel=function(a){return t(this,void 0,void 0,(function(){var i,o,c,s,u,l,h,p=this;return e(this,(function(f){switch(f.label){case 0:return[4,(0,r.fetchApi)(this.site+a)];case 1:return[4,f.sent().text()];case 2:return i=f.sent(),o=(0,n.load)(i),c={path:a,name:o(".name h1").text().trim()||"Untitled",cover:"https:"+o(".img-cover img").attr("data-src"),summary:o(".section-body.summary").text().trim(),chapters:[]},o(".meta.box p").each((function(t,e){var n=o(e).find("strong").text(),r=o(e).find("a");switch(n){case"Authors :":c.author=r.find("span").map((function(t,e){return o(e).text()})).toArray().join(", ");break;case"Status :":c.status=r.text();break;case"Genres :":c.genres=r.text().trim()}})),s=o("script").text().match(/bookId = (\d+);/)[1],u=[],l=function(a){return t(p,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"api/manga/").concat(a,"/chapters?source=detail"),[4,(0,r.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return i=e.sent(),(o=(0,n.load)(i))("li").each((function(t,e){var n,r=o(e).find(".chapter-title").text().trim(),a=o(e).find(".chapter-update").text().trim(),i=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],c=i.join("|"),s=new RegExp("(".concat(c,") (\\d{1,2}), (\\d{4})"),"i").exec(a);if(s){var l=+s[3],h=i.indexOf(s[1].toLowerCase()),p=+s[2],f=null===(n=o(e).find("a").attr("href"))||void 0===n?void 0:n.slice(1);f&&u.push({name:r,releaseTime:new Date(l,h,p).toISOString(),path:f})}})),[2,u]}}))}))},h=c,[4,l(s)];case 3:return h.chapters=f.sent().reverse(),[2,c]}}))}))},a.prototype.parseChapter=function(a){return t(this,void 0,void 0,(function(){var t,i;return e(this,(function(e){switch(e.label){case 0:return[4,(0,r.fetchApi)(this.site+a)];case 1:return[4,e.sent().text()];case 2:return t=e.sent(),(i=(0,n.load)(t))("#listen-chapter").remove(),i("#google_translate_element").remove(),[2,i(".chapter__content").html()||""]}}))}))},a.prototype.searchNovels=function(a,i){return t(this,void 0,void 0,(function(){var t,o,c;return e(this,(function(e){switch(e.label){case 0:return t="".concat(this.site,"search?q=").concat(a,"&page=").concat(i),[4,(0,r.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return o=e.sent(),c=(0,n.load)(o),[2,this.parseNovels(c)]}}))}))},a}();exports.default=new a;